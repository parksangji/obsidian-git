Nested Loop Join은 두 개 이상의 테이블을 조인하는 가장 기본적인 알고리즘 중 하나이다.

```sql
SELECT * 
FROM team 
JOIN users on team.department_no = users.department_no 
where team.department_no between 51 and 90;
```

작동 방식은 이름 그대로 중첩된 반복문을 사용하여 조인을 수행한다. 

1. 외부 테이블(Outer Table) 선택 : 조인에 참여하는 테이블 중 하나를 외부 테이블로 선택한다. 일반적으로 더 작은 테이블이 외부 테이블로 선택된다. 
2. 외부 테이블 순회: 외부 테이블의 각 행을 순차적으로 읽는다. 
3. 내부 테이블(Inner Table) 스캔: 외부 테이블의 현재 행에 대해, 내부 테이블 전체를 스캔하면서 조인 조건을 만족하는 행을 찾는다. 
4. 결과 반환: 조인 조건을 만족하는 외부 테이블 행과 내부 테이블 행을 결합하여 결과를 반환한다. 
5. 반복: 외부 테이블의 모든 행에 대해 3단계와 4단계를 반복한다. 

![[Pasted image 20250319170602.png]]
- Nested Loop의 장점으로는 다른 조인 알고리즘에 비해 메모리 사용량이 적다. 또한 구현이 간단하고 이해하기 쉽다. ==또한 외부 테이블의 크기가 매우 작으면 내부 테이블을 스캔하는 횟수가 적어 빠를 수 있다.== 
- 내부 테이블에 인덱스가 있는 경우 매우 효율적(Index Nexted Loop)이다. 내부 테이블의 조인 컬럼에 인덱스가 있으면, 외부 테이블의 각 행에 대해 인덱스를 사용하여 빠르게 내부 테이블 행을 찾을 수 있다. 

- 단점으로는 내부 테이블를 반복적으로 스캔한다는 것이다. 외부 테이블의 각 행에 대해 내부 테이블 전체를 스캔해야 하므로 외부 테이블이 크거나 내부 테이블에 인덱스가 없으면 매우 비효율적이다. O(N x M)
- 내부 테이블에 인덱스가 없으면 디스크에서 데이터를 읽어올 때 랜덤 액세스가 발생하여 성능이 저하된다. 

최적화 : Index Nested Loop

Nested Loop Join의 성능을 크게 향상키니는 중요한 방법은 내부 테이블의 조인 컬럼에 인덱스를 생성하는 것이다. 이를 Index Nested Loop라고 한다. 

1. 외부 테이블의 행을 읽는다. 
2. 내부 테이블의 인덱스를 사용하여 조인 조건에 맞는 행을 빠르게 찾는다. 
3. 인덱스를 통해 찾은 행의 데이터만 읽어온다. 



