---
title: "데이터베이스 복제 (Database Replication)"
category: "Database"
description: "데이터베이스의 가용성, 확장성, 백업 등을 위해 데이터를 여러 서버에 복사하는 기술"
image: "/assets/images/example.png" # 이미지 경로
---

# 데이터베이스 복제 (Database Replication)

## 데이터베이스 복제란?

데이터베이스 복제는 하나의 데이터베이스(원본 또는 마스터/프라이머리)의 데이터를 다른 여러 개의 데이터베이스(복제본 또는 슬레이브/레플리카) 서버에 복사하고 동기화하는 프로세스입니다. 이를 통해 데이터의 사본을 여러 위치에 유지할 수 있습니다.

## 복제를 사용하는 이유

데이터베이스 복제는 다음과 같은 다양한 목적을 위해 사용됩니다.

1.  **고가용성 (High Availability):**
    * 원본(프라이머리) 서버에 장애가 발생하더라도, 복제(레플리카) 서버 중 하나가 즉시 서비스를 이어받아(Failover) 다운타임을 최소화할 수 있습니다.
2.  **읽기 확장성 (Read Scalability):**
    * 읽기(SELECT) 요청을 여러 레플리카 서버로 분산시켜 프라이머리 서버의 부하를 줄이고 전체 시스템의 읽기 처리량을 높일 수 있습니다. 쓰기(INSERT, UPDATE, DELETE) 작업은 여전히 프라이머리 서버에서 처리됩니다.
3.  **재해 복구 및 백업 (Disaster Recovery & Backup):**
    * 지리적으로 떨어진 곳에 레플리카 서버를 두어 원본 서버가 위치한 데이터 센터에 재해가 발생해도 데이터를 보호하고 서비스를 복구할 수 있습니다. 레플리카는 실시간 백업의 역할도 수행할 수 있습니다.
4.  **데이터 지역성 (Data Locality):**
    * 사용자와 가까운 지역에 레플리카 서버를 배치하여 데이터 접근 속도를 향상시킬 수 있습니다.
5.  **분석 및 리포팅 부하 분산:**
    * 무거운 분석 쿼리나 리포팅 작업을 레플리카 서버에서 수행하여, 트랜잭션 처리가 주인 프라이머리 서버의 성능에 영향을 주지 않도록 할 수 있습니다.

## 일반적인 복제 구성 (Topologies)

* **마스터-슬레이브 (Master-Slave / Primary-Replica):**
    * 가장 일반적인 구성입니다. 하나의 프라이머리 서버가 모든 쓰기 작업을 처리하고, 이 변경 사항을 하나 이상의 레플리카 서버로 복제합니다. 레플리카 서버는 보통 읽기 전용(Read-Only) 요청을 처리합니다.
* **마스터-마스터 (Master-Master / Active-Active):**
    * 두 대 이상의 서버가 모두 쓰기 작업을 처리할 수 있으며, 각 서버의 변경 사항이 다른 서버로 상호 복제됩니다.
    * 구성 및 관리가 더 복잡하며, 특히 동일한 데이터를 동시에 수정할 경우 발생하는 충돌(Conflict)을 해결하는 메커니즘이 필요합니다.

## 복제 방식 (Methods)

데이터 변경 사항을 프라이머리에서 레플리카로 전파하는 방식에 따라 동기/비동기/반동기로 나뉩니다.

1.  **동기 복제 (Synchronous Replication):**
    * 프라이머리 서버에서 트랜잭션이 커밋될 때, **하나 이상의 레플리카 서버로부터 변경 사항이 수신(또는 적용)되었다는 확인 응답을 받아야만** 최종적으로 커밋을 완료합니다.
    * **장점:** 프라이머리 서버 장애 시에도 데이터 손실이 발생하지 않음을 보장합니다. 레플리카는 항상 프라이머리와 동일한 최신 상태를 유지합니다.
    * **단점:** 프라이머리 서버의 쓰기 작업 지연 시간(latency)이 증가합니다. 레플리카 서버의 응답이 느리거나 장애가 발생하면 프라이머리 서버의 작업이 지연될 수 있습니다.
2.  **비동기 복제 (Asynchronous Replication):**
    * 프라이머리 서버는 레플리카 서버의 확인 응답을 **기다리지 않고** 트랜잭션을 커밋합니다. 변경 사항은 백그라운드에서 레플리카로 전송됩니다.
    * **장점:** 프라이머리 서버의 쓰기 작업 지연 시간이 매우 낮습니다. 레플리카 서버의 상태가 프라이머리 서버 성능에 영향을 주지 않습니다.
    * **단점:** 프라이머리 서버 장애 시, 아직 레플리카로 전송되지 않은 최근 변경 사항이 유실될 수 있습니다. 레플리카 서버가 프라이머리 서버보다 뒤처지는 현상(Replication Lag)이 발생할 수 있습니다.
3.  **반동기 복제 (Semi-Synchronous Replication):**
    * 동기와 비동기의 절충안입니다. 프라이머리 서버는 **최소 하나**의 레플리카 서버로부터 확인 응답을 받으면 커밋을 완료하지만, 모든 레플리카를 기다리지는 않습니다.
    * **장점:** 비동기 방식보다 데이터 내구성이 높으면서, 동기 방식보다는 쓰기 지연 시간이 짧습니다.
    * **단점:** 여전히 약간의 쓰기 지연이 발생하며, 응답을 보낸 레플리카 외 다른 레플리카는 뒤처질 수 있습니다.

## PostgreSQL의 복제 메커니즘

PostgreSQL은 강력한 내장 복제 기능을 제공합니다.

* **스트리밍 복제 (Streaming Replication):**
    * 가장 널리 사용되는 방식입니다. 프라이머리 서버가 생성하는 WAL(Write-Ahead Log) 레코드를 네트워크를 통해 레플리카 서버로 실시간 전송(스트리밍)합니다. 동기 또는 비동기 방식으로 설정 가능합니다.
    * 레플리카 서버는 받은 WAL 레코드를 적용하여 프라이머리 서버의 상태를 따라잡습니다. 보통 레플리카는 읽기 전용 상태(Hot Standby)로 운영되어 읽기 요청을 처리할 수 있습니다.
* **논리 복제 (Logical Replication):**
    * 물리적인 WAL 레코드 대신, 데이터 변경 사항(INSERT, UPDATE, DELETE 등)을 논리적인 형태로 디코딩하여 레플리카로 전송합니다.
    * **장점:** 특정 테이블만 선택적으로 복제하거나, 서로 다른 PostgreSQL 메이저 버전 간에도 복제가 가능하며, 여러 데이터베이스의 변경 사항을 하나로 통합하는 등의 유연한 구성이 가능합니다.

## 주요 고려 사항

* **복제 지연 (Replication Lag):** 특히 비동기 복제에서 프라이머리와 레플리카 간의 데이터 차이가 발생하는 시간. 애플리케이션은 이 지연을 인지하고 설계해야 할 수 있습니다(예: 방금 쓴 데이터를 바로 레플리카에서 읽으려 할 때 없을 수 있음). 모니터링이 필수적입니다.
* **장애 조치 (Failover):** 프라이머리 서버 장애 시 레플리카 서버를 새로운 프라이머리로 승격시키는 과정. 수동으로 진행하거나 Patroni, repmgr과 같은 외부 도구를 사용하여 자동화할 수 있습니다.
* **충돌 해결 (Conflict Resolution):** 특히 마스터-마스터 복제에서 중요합니다. 동일한 데이터가 동시에 다른 마스터에서 변경될 경우 어떻게 처리할지 정책이 필요합니다.
* **모니터링 및 관리:** 복제 상태, 지연 시간, 서버 리소스 등을 지속적으로 모니터링하고 관리하는 도구와 프로세스가 필요합니다.

## 백엔드 개발자와의 관련성

* **시스템 아키텍처 설계:** 고가용성 및 확장성을 위해 데이터베이스 복제(읽기 부하 분산을 위한 레플리카, 장애 대비를 위한 스탠바이)를 고려한 시스템 아키텍처 설계가 필요합니다.
* **성능 및 안정성:** 복제 구성을 이해하면 읽기/쓰기 부하 분산 전략을 세우고, 장애 발생 시 서비스 연속성을 확보하는 데 도움이 됩니다.
* **데이터 일관성:** 특히 비동기 복제 사용 시 발생할 수 있는 복제 지연을 인지하고, 이로 인해 발생할 수 있는 데이터 불일치 문제를 애플리케이션 레벨에서 어떻게 처리할지 고려해야 합니다.
* **DB 운영 및 관리:** 복제 설정(PostgreSQL의 `postgresql.conf`, `pg_hba.conf`, `recovery.conf` 등), 모니터링, 장애 조치 계획 수립 등 데이터베이스 운영 측면의 이해가 필요합니다.

데이터베이스 복제는 안정적이고 확장 가능한 데이터 중심 백엔드 애플리케이션을 구축하는 데 필수적인 기술입니다. 애플리케이션의 요구 사항(가용성, 성능, 일관성 수준 등)에 맞춰 적절한 복제 방식과 구성을 선택하고 관리하는 것이 중요합니다.

다음 학습을 원하시면 "다음"을 입력해주세요.